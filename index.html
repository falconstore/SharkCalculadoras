<!DOCTYPE html>
<html lang="pt-BR" data-theme="emerald">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadoras Shark</title>
  <link rel="stylesheet" href="shark-theme.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  </style>
</head>
<body class="min-h-screen p-4 md:p-8">
  <div class="max-w-6xl mx-auto">
    <header class="mb-4">
      <h1 class="text-strong text-2xl md:text-3xl font-extrabold tracking-tight">Calculadoras Shark</h1>
    </header>

    <div role="tablist" aria-label="Calculadoras" class="flex items-center gap-2 mb-4">
      <button id="tabBtn1" role="tab" aria-selected="true" aria-controls="panel-1" class="tab" tabindex="0">Calculadora Shark 1</button>
      <button id="tabBtn2" role="tab" aria-selected="false" aria-controls="panel-2" class="tab" tabindex="-1">Calculadora Shark 2</button>
    </div>

    <section id="panel-1" role="tabpanel" aria-labelledby="tabBtn1">
      <div id="app"></div>
    </section>

    <section id="panel-2" role="tabpanel" aria-labelledby="tabBtn2" hidden>
      <div class="panel p-3 shadow-lg">
        <h2 class="text-accent text-lg font-bold uppercase tracking-wider mb-3 center">Calculadora Shark 2</h2>
        <iframe id="calc2frame" title="Calculadora Shark 2" class="w-full border rounded-lg shadow-lg" style="min-height: 1200px; background: transparent;"></iframe>
      </div>
    </section>
  </div>

<script>
// Abas acessíveis
(() => {
  const tabs = Array.from(document.querySelectorAll('[role="tab"]'));
  const panels = [document.getElementById('panel-1'), document.getElementById('panel-2')];
  const iframe = document.getElementById('calc2frame');
  const THEME_CSS = `
:root {
  color-scheme: dark;
  --bg1: #03100c;
  --bg2: #05201a;
  --bg3: #083227;
  --bg4: #0b4234;
  --text: #eafff7;
  --muted: #b9f5df;
  --card: rgba(7, 25, 20, .6);
  --border: rgba(16, 185, 129, 0.28);
  --accent: #10b981; /* emerald */
  --accent2: #34d399;
  --success: #22c55e;
  --danger: #f87171;
}

body {
  background: linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 25%, var(--bg3) 50%, var(--bg4) 100%);
  color: var(--text);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, 'Helvetica Neue', Arial, 'Noto Sans';
}

.tab {
  padding: 10px 14px;
  font-weight: 800;
  border-radius: 10px 10px 0 0;
  border: 1px solid transparent;
  cursor: pointer;
  color: var(--muted);
  background: transparent;
}
.tab[aria-selected="true"] {
  background: rgba(16,185,129,.18);
  color: var(--text);
  border-color: var(--border);
  border-bottom-color: transparent;
}
.panel {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
}

input, select, textarea {
  background: rgba(3, 16, 12, .35);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 6px 10px;
  outline: none;
}
input:focus, select:focus, textarea:focus {
  box-shadow: 0 0 0 3px rgba(16,185,129,.25);
  border-color: rgba(16,185,129,.45);
}

button, .btn {
  background-image: linear-gradient(90deg, var(--accent), var(--accent2));
  color: #fff;
  border: 0;
  border-radius: 10px;
  font-weight: 800;
  padding: 8px 14px;
  cursor: pointer;
}
button:hover, .btn:hover { filter: brightness(1.05); }

/* Utilidades extras */
.text-accent { color: var(--accent) !important; }
.text-strong { color: var(--text) !important; }
.text-soft   { color: var(--muted) !important; }
.bg-card { background: var(--card) !important; border: 1px solid var(--border) !important; border-radius: 12px !important; }
.box     { background: rgba(3,16,12,.35) !important; border: 1px solid var(--border) !important; border-radius: 8px !important; color: var(--text) !important; }
input[type="checkbox"], input[type="radio"] { accent-color: var(--accent); }

/* Tablist sem borda */
[role="tablist"] { border: none !important; }
.border, .border-b, .border-t, .border-l, .border-r { border-color: var(--border) !important; }
`;
  const CALC2_HTML = `<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora Promo Freebet</title>
  <style>
    :root{--bg:#0b0f14;--card:#10161d;--muted:#8aa0b2;--fg:#e8f0ff;--accent:#32d583;--border:#1f2a36}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Ubuntu,Arial}
    .wrap{max-width:980px;margin:24px auto;padding:16px}
    h1{margin:0 0 8px;font-size:clamp(18px,2.4vw,28px)}
    .sub{color:var(--muted);font-size:14px;margin-bottom:16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:12px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input,select{width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:#0e141b;color:var(--fg);font-size:15px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:#0e141b;color:var(--fg);font-weight:700;cursor:pointer}
    .btn.primary{background:var(--accent);color:#052814;border-color:#1a4230}
    table{width:100%;border-collapse:collapse;margin-top:12px;border:1px solid var(--border);border-radius:12px;overflow:hidden}
    th,td{padding:10px;border-bottom:1px solid var(--border);text-align:right}
    th:first-child,td:first-child{text-align:left}
    th{background:#0e141b}
    .highlight{color:var(--accent);font-weight:800}
    .small{font-size:12px;color:var(--muted)}
    .status{margin-top:12px;padding:12px;border-radius:12px;border:1px solid var(--border);display:none}
    .ok{background:rgba(50,213,131,.08);border-color:#1a4230}
    .warn{background:rgba(255,176,32,.08);border-color:#604411}
    .err{background:rgba(255,107,107,.08);border-color:#5b1e1e}
    .grid{display:grid;gap:12px}
    .grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .grid.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width:900px){.grid.cols-3,.grid.cols-2{grid-template-columns:1fr}}
    .infoBtn{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:50%;border:1px solid var(--muted);color:var(--muted);font-size:10px;font-weight:700;margin-left:6px;cursor:help;position:relative;top:-1px}
    .infoBtn:hover{color:#fff;border-color:#fff}
    .infoBtn::after{content:attr(data-tip);position:absolute;bottom:150%;left:50%;transform:translateX(-50%);background:#0e141b;color:#fff;border:1px solid var(--border);padding:6px 8px;border-radius:8px;white-space:nowrap;opacity:0;pointer-events:none;transition:opacity .12s ease;font-size:12px;z-index:5}
    .infoBtn::before{content:"";position:absolute;bottom:138%;left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:#0e141b;opacity:0;transition:opacity .12s ease;z-index:5}
    .infoBtn:hover::after,.infoBtn:hover::before{opacity:1}
    /* ==== Coberturas inline (cards coloridos) ==== */
    .covGrid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .covItem{background:#0e141b;border:1px solid var(--border);border-radius:12px;padding:12px;border-left:4px solid var(--accent)}
    .covItem:nth-child(1){border-left-color:#22c55e}
    .covItem:nth-child(2){border-left-color:#f59e0b}
    .covItem:nth-child(3){border-left-color:#ef4444}
    .covItem:nth-child(4){border-left-color:#3b82f6}
    .covItem:nth-child(5){border-left-color:#a855f7}
    .covTitle{font-weight:700;font-size:13px;color:#cbd5e1;margin-bottom:8px}
    .covRow{display:flex;gap:12px;align-items:end}
    .field{flex:1;min-width:0}
    .field label{margin:0 0 4px;font-size:11px;color:var(--muted)}
    .field input{width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:#0b1117;color:var(--fg)}
    .field-lay{display:flex;align-items:center;gap:8px;padding:10px;border:1px dashed var(--border);border-radius:8px;height:42px}
    .field-lay input{width:auto}
    /* ==== Casa Promo em destaque ==== */
    .promoCard{background:linear-gradient(180deg,#0f1720,#0d131a);border:1px solid #1f3347;border-left:4px solid #06b6d4;box-shadow:0 0 0 1px rgba(6,182,212,.08) inset;border-radius:12px;padding:14px}
    .promoHead{display:flex;align-items:center;gap:8px;margin-bottom:8px}
    .promoBadge{font-size:10px;letter-spacing:.06em;background:#062a33;color:#a6f6ff;border:1px solid #0b3f4d;padding:2px 6px;border-radius:999px;font-weight:800;text-transform:uppercase}
    .promoRow{display:flex;gap:12px;flex-wrap:wrap}
    .promoRow .field{flex:1}
    .promoCard .field label{font-size:10px;margin-bottom:4px}
    .promoCard .field input{padding:10px;font-size:15px}
    @media (max-width:900px){.promoRow{flex-direction:column}}
      /* ==== Cores internas mais destacadas (override) ==== */
    .covItem{position:relative;overflow:hidden}
    .covTitle{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid var(--border);font-weight:800;font-size:12px;margin-bottom:10px}
    .covRow{align-items:stretch}
    /* Verde */
    .covItem:nth-child(1){border-left-color:#22c55e;background:linear-gradient(180deg,rgba(34,197,94,.12),rgba(34,197,94,.03))}
    .covItem:nth-child(1) .covTitle{background:rgba(34,197,94,.18);border-color:rgba(34,197,94,.45);color:#e9ffef}
    .covItem:nth-child(1) .field input:focus{border-color:#22c55e;box-shadow:0 0 0 2px rgba(34,197,94,.25);background:rgba(34,197,94,.06)}
    .covItem:nth-child(1) .field-lay{border-color:rgba(34,197,94,.45);background:rgba(34,197,94,.06)}
    /* Âmbar */
    .covItem:nth-child(2){border-left-color:#f59e0b;background:linear-gradient(180deg,rgba(245,158,11,.12),rgba(245,158,11,.03))}
    .covItem:nth-child(2) .covTitle{background:rgba(245,158,11,.18);border-color:rgba(245,158,11,.45);color:#fff6e6}
    .covItem:nth-child(2) .field input:focus{border-color:#f59e0b;box-shadow:0 0 0 2px rgba(245,158,11,.25);background:rgba(245,158,11,.06)}
    .covItem:nth-child(2) .field-lay{border-color:rgba(245,158,11,.45);background:rgba(245,158,11,.06)}
    /* Vermelho */
    .covItem:nth-child(3){border-left-color:#ef4444;background:linear-gradient(180deg,rgba(239,68,68,.12),rgba(239,68,68,.03))}
    .covItem:nth-child(3) .covTitle{background:rgba(239,68,68,.18);border-color:rgba(239,68,68,.45);color:#ffecec}
    .covItem:nth-child(3) .field input:focus{border-color:#ef4444;box-shadow:0 0 0 2px rgba(239,68,68,.25);background:rgba(239,68,68,.06)}
    .covItem:nth-child(3) .field-lay{border-color:rgba(239,68,68,.45);background:rgba(239,68,68,.06)}
    /* Azul */
    .covItem:nth-child(4){border-left-color:#3b82f6;background:linear-gradient(180deg,rgba(59,130,246,.12),rgba(59,130,246,.03))}
    .covItem:nth-child(4) .covTitle{background:rgba(59,130,246,.18);border-color:rgba(59,130,246,.45);color:#e8f1ff}
    .covItem:nth-child(4) .field input:focus{border-color:#3b82f6;box-shadow:0 0 0 2px rgba(59,130,246,.25);background:rgba(59,130,246,.06)}
    .covItem:nth-child(4) .field-lay{border-color:rgba(59,130,246,.45);background:rgba(59,130,246,.06)}
    /* Roxo */
    .covItem:nth-child(5){border-left-color:#a855f7;background:linear-gradient(180deg,rgba(168,85,247,.12),rgba(168,85,247,.03))}
    .covItem:nth-child(5) .covTitle{background:rgba(168,85,247,.18);border-color:rgba(168,85,247,.45);color:#f4e8ff}
    .covItem:nth-child(5) .field input:focus{border-color:#a855f7;box-shadow:0 0 0 2px rgba(168,85,247,.25);background:rgba(168,85,247,.06)}
    .covItem:nth-child(5) .field-lay{border-color:rgba(168,85,247,.45);background:rgba(168,85,247,.06)}
    /* ==== Cores dos CENÁRIOS nas linhas da tabela ==== */
    #results table tr.scn-1 td{background:linear-gradient(180deg,rgba(6,182,212,.14),rgba(6,182,212,.04))}
    #results table tr.scn-1 td:first-child{border-left:4px solid #06b6d4}

    #results table tr.scn-2 td{background:linear-gradient(180deg,rgba(34,197,94,.12),rgba(34,197,94,.03))}
    #results table tr.scn-2 td:first-child{border-left:4px solid #22c55e}

    #results table tr.scn-3 td{background:linear-gradient(180deg,rgba(245,158,11,.12),rgba(245,158,11,.03))}
    #results table tr.scn-3 td:first-child{border-left:4px solid #f59e0b}

    #results table tr.scn-4 td{background:linear-gradient(180deg,rgba(239,68,68,.12),rgba(239,68,68,.03))}
    #results table tr.scn-4 td:first-child{border-left:4px solid #ef4444}

    #results table tr.scn-5 td{background:linear-gradient(180deg,rgba(59,130,246,.12),rgba(59,130,246,.03))}
    #results table tr.scn-5 td:first-child{border-left:4px solid #3b82f6}

    #results table tr.scn-6 td{background:linear-gradient(180deg,rgba(168,85,247,.12),rgba(168,85,247,.03))}
    #results table tr.scn-6 td:first-child{border-left:4px solid #a855f7}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Calculadora Promo Freebet</h1>
    <div class="sub">Casa Promo paga <b>freebet</b> apenas se a <b>Entrada 1</b> perder. Selecione N (2–6) e preencha as coberturas. Tabela final: Cenário | Odd | Apostar | Lucro Final.</div>

    <!-- Nº de Entradas -->
    <div class="card">
      <label>Entradas (mercados)</label>
      <select id="numEntradas">
        <option value="2">2</option>
        <option value="3" selected>3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
      </select>
    </div>

    <!-- Casa Promo -->
    <div class="promoCard">
      <div class="promoHead"><span class="promoBadge">Casa Promo</span></div>
      <div class="promoRow">
        <div class="field">
          <label>Odd – Casa Promoção</label>
          <input id="o1" placeholder="ex: 3" inputmode="decimal" />
        </div>
        <div class="field">
          <label>Comissão (%)</label>
          <input id="c1" placeholder="ex: 0" inputmode="decimal" />
        </div>
        <div class="field">
          <label>Stake de Qualificação (Casa Promo)</label>
          <input id="s1" placeholder="ex: 50" inputmode="decimal" />
        </div>
      </div>
      <div class="promoRow">
        <div class="field">
          <label>Valor da Freebet</label>
          <input id="F" placeholder="ex: 50" inputmode="decimal" />
        </div>
        <div class="field">
          <label>Taxa de Extração (%)</label>
          <input id="r" placeholder="ex: 70" inputmode="decimal" />
        </div>
        <div class="field">
          <label>Arredondar Stakes</label>
          <select id="round_step">
            <option value="0.01">R$ 0,01</option>
            <option value="0.10">R$ 0,10</option>
            <option value="0.50">R$ 0,50</option>
            <option value="1.00" selected>R$ 1,00</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Coberturas dinâmicas -->
    <div class="card">
      <div id="oddsContainer" class="covGrid"></div>
    </div>

    <!-- Stake Total -->
    <div class="card">
      <div>
        <label>Stake Total</label>
        <h3 id="k_S" style="margin:8px 0 0 0">–</h3>
      </div>
    </div>

    <!-- Ações -->
    <div class="row">
      <button class="btn primary" id="calcBtn">Calcular</button>
      <button class="btn" id="clearBtn">Limpar</button>
      
    </div>

    <div id="status" class="status warn"></div>

    <!-- Resultado -->
    <div class="card" id="results" style="display:none">
      <table>
        <thead><tr><th>Cenário</th><th>Odd</th><th>Comissão (%)</th><th>Apostar</th><th>Lucro Final</th></tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

<script>
'use strict';
(function(){
  // ===== Utils
  function $(id){ return document.getElementById(id); }
  function nf(v){ return Number.isFinite(v) ? new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL',maximumFractionDigits:2}).format(v) : '–'; }
  function toNum(s){
    if(s===undefined||s===null) return NaN; var str=String(s).trim(); if(!str) return NaN;
    if(str.indexOf(',')!==-1 && str.indexOf('.')!==-1) return parseFloat(str.replace(/\\./g,'').replace(',','.'));
    if(str.indexOf(',')!==-1) return parseFloat(str.replace(',','.'));
    return parseFloat(str);
  }
  function showStatus(cls,msg){ var el=$("status"); el.className='status '+cls; el.style.display='block'; el.textContent=msg; }
  function hideStatus(){ $("status").style.display='none'; }

  // Odd efetiva com comissão (sobre lucro)
  function effOdd(o, cPerc){ var c = (Number.isFinite(cPerc) && cPerc>0) ? (cPerc/100) : 0; return 1 + (o-1)*(1-c); }

  // ===== Render dinâmico (preserva valores durante troca de N)
  function captureCoverageValues(){
    var nodes = document.querySelectorAll('#oddsContainer > div');
    var out=[]; for(var i=0;i<nodes.length;i++){
      var odd = nodes[i].querySelector('input[data-type="odd"]');
      var com = nodes[i].querySelector('input[data-type="comm"]');
      var lay = nodes[i].querySelector('input[data-type="lay"]');
      out.push({odd: odd?odd.value:'', com: com?com.value:'', lay: lay?lay.checked:false});
    }
    return out;
  }

  function renderOddsInputs(){
    var n = parseInt($("numEntradas").value||'3',10);
    var prev = captureCoverageValues();
    var c = $("oddsContainer"); c.innerHTML='';
    var blocks = Math.max(1, n-1);
    for(var i=0;i<blocks;i++){
      var card = document.createElement('div'); card.className='covItem';
      var title = document.createElement('div'); title.className='covTitle'; title.textContent = 'Resultado ' + (i+2);
      var row = document.createElement('div'); row.className='covRow';
      // Odd
      var fOdd = document.createElement('div'); fOdd.className='field';
      var lOdd = document.createElement('label'); lOdd.textContent='Odd';
      var iOdd = document.createElement('input'); iOdd.setAttribute('inputmode','decimal'); iOdd.placeholder='ex: 2,50'; iOdd.setAttribute('data-type','odd');
      // Comissão
      var fCom = document.createElement('div'); fCom.className='field';
      var lCom = document.createElement('label'); lCom.textContent='Comissão (%)';
      var iCom = document.createElement('input'); iCom.setAttribute('inputmode','decimal'); iCom.placeholder='ex: 0'; iCom.setAttribute('data-type','comm');
      // Lay
      var fLay = document.createElement('div'); fLay.className='field-lay';
      var iLay = document.createElement('input'); iLay.type='checkbox'; iLay.setAttribute('data-type','lay');
      var tLay = document.createElement('span'); tLay.textContent='Lay';
      if(prev[i]){ iOdd.value=prev[i].odd; iCom.value=prev[i].com; iLay.checked=!!prev[i].lay; }
      fOdd.appendChild(lOdd); fOdd.appendChild(iOdd);
      fCom.appendChild(lCom); fCom.appendChild(iCom);
      fLay.appendChild(iLay); fLay.appendChild(tLay);
      row.appendChild(fOdd); row.appendChild(fCom); row.appendChild(fLay);
      card.appendChild(title); card.appendChild(row);
      c.appendChild(card);
    }
  }

  function readCoverage(){
    var odds = [], comm = [], isLay = [];
    var oInputs = document.querySelectorAll('#oddsContainer input[data-type="odd"]');
    var cInputs = document.querySelectorAll('#oddsContainer input[data-type="comm"]');
    var lInputs = document.querySelectorAll('#oddsContainer input[data-type="lay"]');
    for(var i=0;i<oInputs.length;i++){ odds.push(toNum(oInputs[i].value)); }
    for(var j=0;j<cInputs.length;j++){ comm.push(toNum(cInputs[j].value)); }
    for(var k=0;k<lInputs.length;k++){ isLay.push(!!lInputs[k].checked); }
    return {odds:odds, comm:comm, isLay:isLay};
  }

  // ===== Cálculo (back + lay)
  function calc(){
    hideStatus();
    var o1=toNum($("o1").value);
    var c1=toNum($("c1").value);
    var n = parseInt($("numEntradas").value||'3',10);
    var cov = readCoverage();
    var F=toNum($("F").value), rPerc=toNum($("r").value);
    var s1=toNum($("s1").value);

    if(!Number.isFinite(o1)||o1<=1){ showStatus('warn','Informe odd válida (>1) para a Casa Promo.'); return }
    if(cov.odds.length !== (n-1) || cov.odds.some(function(v){return !Number.isFinite(v)||v<=1;})){
      showStatus('warn','Informe '+(n-1)+' odds válidas (>1) para as coberturas.'); return }
    if(!Number.isFinite(F)||F<0){ showStatus('warn','Informe Valor da Freebet válido.'); return }
    if(!Number.isFinite(rPerc)||rPerc<0||rPerc>100){ showStatus('warn','Taxa de extração deve estar entre 0 e 100.'); return }
    if(!Number.isFinite(s1)||s1<=0){ showStatus('warn','Informe S1 (stake de qualificação) válida.'); return }

    var o1e = effOdd(o1,c1);
    var r = rPerc/100; var rF = r*F;
    var A = s1*o1e - rF; // alvo

    // Stakes coberturas (back/lay)
    var stakes = [], eBack = [], commFrac = [], oddsOrig = cov.odds.slice();
    for(var i=0;i<cov.odds.length;i++){
      var L = cov.odds[i];
      var cfrac = (Number.isFinite(cov.comm[i]) && cov.comm[i]>0) ? cov.comm[i]/100 : 0; commFrac[i]=cfrac;
      if(cov.isLay[i]){
        var denom = L-1; if(!(denom>0)){ showStatus('warn','Odd para LAY deve ser >1,00.'); return }
        // Conversão LAY -> back-equivalente:
        // odd_eff_lay = 1 + (1 - c)/(L - 1) = (L - c)/(L - 1)
        var eLay = 1 + (1 - cfrac)/denom; // para tooltip e cálculo equivalente
        var equivStake = A / eLay;        // stake equivalente (medida em RESPONSABILIDADE)
        stakes[i] = equivStake / denom;   // stake real de LAY
        eBack[i] = eLay;                  // guardar odd efetiva equivalente para tooltip
      }else{
        var e = effOdd(L, cov.comm[i]); eBack[i]=e; stakes[i]= A/e; // back usa odd efetiva
      }
    }

    // Arredondamento
    var step = parseFloat($("round_step").value) || 1; function roundStep(v){ return Math.round(v/step)*step; }
    stakes = stakes.map(roundStep);

    // Responsabilidades e totais
    var liabilities = stakes.map(function(s,i){ return cov.isLay[i] ? (cov.odds[i]-1)*s : 0; });
    var S = s1 + stakes.reduce(function(a,s,idx){ return a + (cov.isLay[idx] ? (cov.odds[idx]-1)*s : s); }, 0);

// === Lucros por cenário (MODO BALANCEADO • 2–6 entradas) ===
// Regras:
// - Cenário 1 = Casa Promo vence → sem freebet.
// - Cenários 2..N = Casa Promo perde → soma rF.
// - BACK vencedor: payout = stake * odd_efetiva; BACK perdedor: perde stake.
// - LAY vencedor (seleção ocorre): perde responsabilidade; LAY perdedor: ganha stake*(1 - comissão).

function layLiability(i){ return (cov.odds[i]-1) * stakes[i]; }
function layGain(i){ return stakes[i] * (1 - (commFrac[i]||0)); }

// Totais auxiliares para o cenário 1
var totalLayLiab = 0, totalBackStakes = 0;
for (var j=0; j<stakes.length; j++){
  if (cov.isLay[j]) totalLayLiab += layLiability(j);
  else              totalBackStakes += stakes[j];
}

// 1) Casa Promo vence
var net1 = (s1 * (o1e - 1)) - totalLayLiab - totalBackStakes;

// 2) Cada cobertura vence (Casa Promo perde → entra rF)
var nets = [];
for (var win=0; win<stakes.length; win++){
  var netk = -s1; // perde qualificação da Casa Promo

  for (var j=0; j<stakes.length; j++){
    if (cov.isLay[j]){
      // LAY: se j vence → paga responsabilidade; senão → ganha stake*(1 - comissão)
      netk += (j === win) ? -layLiability(j) : layGain(j);
    } else {
      // BACK: se j vence → payout; senão → perde stake
      netk += (j === win) ? (stakes[j] * eBack[j]) : -stakes[j];
    }
  }

  // Freebet extraída
  netk += rF;
  nets[win] = netk;
}

    $("k_S").textContent = nf(S);

    // Tabela – Odd original + coluna de Comissão; Lay mostra responsabilidade ao lado
    var tb=$("tbody"); tb.innerHTML='';
    function oddf(v){ return Number.isFinite(v)? new Intl.NumberFormat('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2}).format(v) : '–'; }
    function pf(v){ return Number.isFinite(v)? new Intl.NumberFormat('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2}).format(v) + '%' : '–'; }
    var rows = [[ '1 vence (Casa Promo)', o1, c1, s1, net1, false, 0, 0 ]];
    for(var k=0;k<stakes.length;k++){
      var isLay = !!cov.isLay[k];
      var liab = liabilities[k];
      var tip = isLay
                       ? ('Odd efetiva (LAY): '+oddf(eBack[k])+' | resp = '+nf(liab)+' | ganho se NÃO vence = '+nf(stakes[k]*(1-commFrac[k])))
                       : ('Odd efetiva (c/ comissão): '+oddf(eBack[k]));
      rows.push([ (k+2)+' vence', oddsOrig[k], cov.comm[k], stakes[k], nets[k], isLay, liab, tip ]);
    }
    for(var rix=0; rix<rows.length; rix++){
      var nome=rows[rix][0], odd=rows[rix][1], comm=rows[rix][2], stake=rows[rix][3], final=rows[rix][4], isLayRow=rows[rix][5], liabRow=rows[rix][6], tipRow=rows[rix][7];
      var oddCell = oddf(odd)+' <span class="infoBtn" data-tip="'+(rix===0?('Odd efetiva (c/ comissão): '+oddf(o1e)):tipRow)+'">i</span>';
      var apostarCell = nf(stake) + (isLayRow ? (' <span class="small">(resp. '+nf(liabRow)+')</span>') : '');
      var tr=document.createElement('tr');
      tr.className = 'scn-'+(rix+1);
      tr.innerHTML = '<td>'+nome+'</td><td>'+oddCell+'</td><td>'+pf(comm)+'</td><td>'+apostarCell+'</td><td class="'+(final>=0?'highlight':'')+'">'+nf(final)+'</td>';
      tb.appendChild(tr);
    }
    $("results").style.display='block';

    window.__last = { s1:s1, stakesCov:stakes, S:S, net1:net1, nets:nets };
  }

  // ===== Eventos
  $("numEntradas").addEventListener('change', renderOddsInputs);
  $("calcBtn").addEventListener('click', calc);
  $("clearBtn").addEventListener('click', function(){
    ["o1","c1","F","r","s1"].forEach(function(id){ $(id).value=''; });
    $("tbody").innerHTML=''; $("results").style.display='none'; $("k_S").textContent='–'; hideStatus();
    renderOddsInputs();
  });

  // ===== Init
  function prefill(){
    renderOddsInputs();
    $("o1").value='3';
    $("c1").value='0';
    $("s1").value='50';
    var inputsOdd = document.querySelectorAll('#oddsContainer input[data-type="odd"]');
    var inputsCom = document.querySelectorAll('#oddsContainer input[data-type="comm"]');
    if(inputsOdd[0]) inputsOdd[0].value = '3';
    if(inputsOdd[1]) inputsOdd[1].value = '2';
    if(inputsCom[0]) inputsCom[0].value = '0';
    if(inputsCom[1]) inputsCom[1].value = '0';
    $("F").value='50';
    $("r").value='70';
    $("round_step").value='1.00';
  }
  window.addEventListener('DOMContentLoaded', prefill);
})();
<\/script>
</body>
</html>
`;

  function setActive(index) {
    tabs.forEach((t,i)=>{
      const selected = i===index;
      t.setAttribute('aria-selected', selected ? 'true' : 'false');
      t.tabIndex = selected ? 0 : -1;
      panels[i].hidden = !selected;
    });
    if (index===1 && !iframe.dataset.loaded) loadCalc2();
    tabs[index].focus();
  }
  tabs[0].addEventListener('click', ()=>setActive(0));
  tabs[1].addEventListener('click', ()=>setActive(1));
  document.querySelector('[role="tablist"]').addEventListener('keydown', (e) => {
    const current = tabs.findIndex(t => t.getAttribute('aria-selected')==='true');
    let next = current;
    if (e.key === 'ArrowRight') next = (current+1) % tabs.length;
    else if (e.key === 'ArrowLeft') next = (current-1+tabs.length) % tabs.length;
    else if (e.key === 'Home') next = 0;
    else if (e.key === 'End') next = tabs.length-1;
    else return;
    e.preventDefault();
    setActive(next);
  });

  function loadCalc2() {
    const doc = (iframe.contentDocument || iframe.contentWindow.document);
    doc.open(); doc.write(CALC2_HTML); doc.close();
    doc.documentElement.setAttribute('data-theme', 'emerald');

    // Injetar tema + alinhamentos e harmonização de bordas
    const style = doc.createElement('style');
    style.textContent = THEME_CSS + `
      html, body { background: transparent !important; color-scheme: dark; }
      body.shark-theme { color: var(--text); }
      .shark-wrap { max-width: 1120px; margin: 0 auto; padding: 4px; }
      .shark-card { background: var(--card) !important; border: 1px solid var(--border) !important; border-radius: 12px !important; }
      input, select, textarea { background: rgba(3,16,12,.35) !important; color: var(--text) !important; border-color: var(--border) !important; }
      button, .btn { background-image: linear-gradient(90deg, var(--accent), var(--accent2)) !important; color: #fff !important; border: 0 !important; border-radius: 10px !important; font-weight: 800 !important; }
      .shark-theme *, .shark-theme *::before, .shark-theme *::after { border-color: var(--border) !important; }
      /* Checkbox Lay */
      .shark-theme label > input[type="checkbox"], .shark-theme input[type="checkbox"] { width:18px; height:18px; margin:0 6px 0 0; vertical-align:middle; }
    `;
    (doc.head || doc.documentElement).appendChild(style);

    // Wrap visual
    const wrap = doc.createElement('div');
    wrap.className = 'shark-theme shark-wrap';
    while (doc.body.firstChild) wrap.appendChild(doc.body.firstChild);
    doc.body.appendChild(wrap);
    doc.body.style.background = 'transparent';

    // Cartões
    Array.from(doc.querySelectorAll('section, .card, .box, .container, .panel')).forEach(el => el.classList.add('shark-card'));

    // Limpa o bloco de instruções inicial (texto e contêiner com borda)
    try {
      const matchText = "Casa Promo paga freebet";
      const cand = Array.from(doc.querySelectorAll('h1,h2,h3,h4,p,div,span,small,strong,em'))
        .find(n => (n.textContent||'').toLowerCase().includes(matchText));
      if (cand) {
        let box = cand;
        for (let i=0; i<6 && box && box.parentElement; i++) {
          const cs = (doc.defaultView || window).getComputedStyle(box);
          const hasBorder = ['Top','Right','Bottom','Left'].some(s => parseFloat(cs['border'+s+'Width'])>0);
          const rounded = parseFloat(cs.borderTopLeftRadius||'0') > 0 || parseFloat(cs.borderTopRightRadius||'0') > 0;
          if (hasBorder || rounded || box.tagName.toLowerCase()==='fieldset') break;
          box = box.parentElement;
        }
        (box || cand).style.display = 'none';
      }
    } catch { }

    iframe.dataset.loaded = "1";
  }
})();
</script>

<script>
/* ==================== Calculadora Shark 1 (lógica intacta) ==================== */
(() => {
  const $ = (sel, root=document) => root.querySelector(sel);

  function parseFlex(n) {
    if (n === null || n === undefined) return NaN;
    const s = String(n).trim();
    if (s === '') return NaN;
    const hasC = s.includes(',');
    const hasD = s.includes('.');
    let t = s;
    if (hasC && !hasD) t = s.replace(',', '.');               
    else if (hasC && hasD) t = s.replace(/\./g,'').replace(',', '.'); 
    const v = parseFloat(t);
    return Number.isFinite(v) ? v : NaN;
  }
  const toFixed2 = (n) => (Number.isFinite(n) ? n.toFixed(2) : "0.00");
  const fmtBRL = (n) => (Number.isFinite(n) ? n : 0).toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
  const fmtDec = (n) => Number.isFinite(n) ? n.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : "";
  const keepNumeric = (s) => s.replace(/[^0-9.,]/g, "");

  const MAX_HOUSES = 6;
  let numHouses = 2;
  let roundingValue = 0.01;
  let displayRounding = "0.01";
  let manualOverrides = {};

  let houses = Array.from({ length: MAX_HOUSES }).map((_, index) => ({ 
    odd: "", increase: "", finalOdd: 0, stake: "0", commission: null, freebet: false, fixedStake: index === 0, lay: false, responsibility: "" 
  }));

  let results = { profits: [], totalStake: 0, roi: 0 };

  const roundStake = (value) => {
    const num = parseFlex(value);
    if (!Number.isFinite(num)) return value;
    const rounded = Math.round(num / roundingValue) * roundingValue;
    return fmtDec(rounded);
  };
  const activeHouses = () => houses.slice(0, numHOUSES = numHouses);

  let pending = false;
  function scheduleUpdate() {
    if (pending) return;
    pending = true;
    requestAnimationFrame(() => {
      pending = false;
      recalcStakeDistribution();
      calculateResults(activeHouses());
      updateAllHouseUIs();
      updateResultsUI();
    });
  }

  function calculateResults(active) {
    let totalStake = 0;
    const profits = new Array(active.length).fill(0);
    active.forEach(h => {
      const stake = parseFlex(h.stake) || 0;
      const resp  = parseFlex(h.responsibility) || 0;
      if (!h.freebet) totalStake += h.lay ? resp : stake;
    });
    active.forEach((h, idx) => {
      const stake = parseFlex(h.stake) || 0;
      const odd = h.finalOdd || 0;
      const commission = h.commission || 0;
      if (h.lay) {
        const resp = parseFlex(h.responsibility) || 0;
        profits[idx] = stake * (1 - commission/100) - (totalStake - resp);
      } else if (h.freebet) {
        const gross = stake * odd - totalStake;
        const comm  = gross > 0 ? (commission/100) * gross : 0;
        profits[idx] = gross - comm;
      } else {
        const effOdd = odd * (1 - commission/100);
        profits[idx] = stake * effOdd - totalStake;
      }
    });
    const minProfit = profits.length ? Math.min(...profits) : 0;
    const denom = active.some(h => h.freebet)
                  ? active.reduce((s,h)=>s+(h.freebet?(parseFlex(h.stake)||0):0),0) || 1
                  : (active.reduce((s,h)=> s + (h.freebet?0 : (h.lay? (parseFlex(h.responsibility)||0) : (parseFlex(h.stake)||0))), 0) || 1);
    const roi = (minProfit/denom)*100;
    results = { profits, totalStake, roi };
  }

  function recalcStakeDistribution() {
    const active = activeHouses();
    const fixedIndex = active.findIndex(h => h.fixedStake);
    if (fixedIndex === -1) return;
    const fixed = active[fixedIndex];
    const fixedStake = parseFlex(fixed.stake) || 0;
    const fixedOdd   = fixed.finalOdd;
    if (!(fixedStake > 0 && fixedOdd > 0)) return;

    let changed = false;
    const newHouses = [...houses];

    active.forEach((h, idx) => {
      const overrides = manualOverrides[idx] || {};
      const oddVal = parseFlex(h.odd) || 0;
      const stakeVal = parseFlex(h.stake) || 0;
      if (h.lay && !overrides.responsibility && oddVal > 1 && stakeVal > 0) {
        const responsibility = stakeVal * (oddVal - 1);
        const current = parseFlex(h.responsibility) || 0;
        if (Math.abs(current - responsibility) > 1e-6) {
          changed = true;
          newHouses[idx] = { ...newHouses[idx], responsibility: fmtDec(responsibility) };
        }
      }
      if (idx !== fixedIndex && h.finalOdd > 0 && !overrides.stake) {
        const fixedCommission = fixed.commission || 0;
        const houseCommission = h.commission || 0;
        const fixedProfit = fixedStake * fixedOdd * (1 - fixedCommission/100);
        let calcStake;
        if (h.lay) {
          calcStake = fixedProfit / (h.finalOdd - houseCommission/100);
        } else {
          const eff = h.finalOdd * (1 - houseCommission/100);
          calcStake = fixedProfit / eff;
        }
        const finalStakeStr = h.lay ? fmtDec(calcStake) : roundStake(calcStake);
        const finalStakeNum = parseFlex(finalStakeStr) || 0;
        const cur = parseFlex(h.stake) || 0;
        if (Math.abs(cur - finalStakeNum) > 1e-6) {
          changed = true;
          if (h.lay) {
            const resp = finalStakeNum * Math.max(oddVal - 1, 0);
            newHouses[idx] = { ...newHouses[idx], stake: finalStakeStr, responsibility: fmtDec(resp), fixedStake: false };
          } else {
            newHouses[idx] = { ...newHouses[idx], stake: finalStakeStr, fixedStake: false };
          }
        }
      }
    });

    if (changed) { houses = newHouses; updateAllHouseUIs(); }
  }

  function cardHTML(idx, h) {
    const oddDisplay = toFixed2(h.finalOdd || 0).replace('.', ',');
    return `
      <div id="card-${idx}" class="bg-card rounded-xl p-3 border shadow-lg">
        <h3 class="text-accent text-sm mb-2 font-bold uppercase tracking-wider text-center">Casa ${idx + 1}</h3>
        <div class="space-y-2">
          <div class="grid grid-cols-2 gap-2">
            <div>
              <label class="text-soft mb-1 block text-xs" for="odd-${idx}">Odd</label>
              <input id="odd-${idx}" data-action="odd" data-idx="${idx}" type="text" inputmode="decimal" value="${h.odd}"
                class="flex h-8 w-full rounded-lg box text-strong px-3 text-xs" />
            </div>
            <div>
              <label class="text-soft mb-1 block text-xs">Odd Final</label>
              <div id="finalOdd-${idx}" class="h-8 flex items-center px-3 box text-xs text-strong font-mono">${oddDisplay}</div>
            </div>
          </div>

          <div>
            <label class="text-soft mb-1 block text-xs" for="stake-${idx}">Stake</label>
            <div class="flex gap-2">
              <div class="relative flex-1">
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-soft text-xs font-bold">R$</span>
                <input id="stake-${idx}" data-action="stake" data-idx="${idx}" type="text" inputmode="decimal" value="${h.stake || ''}"
                  class="pl-10 flex h-8 w-full rounded-lg box text-strong px-3 text-xs font-mono" />
              </div>
              <button data-action="toggleLay" data-idx="${idx}" class="btn text-white rounded-lg text-xs font-black h-8 px-3">${h.lay ? 'L' : 'B'}</button>
            </div>
          </div>

          <div class="flex flex-wrap gap-3">
            <label class="flex items-center space-x-2 text-soft text-xs cursor-pointer select-none">
              <input type="checkbox" ${h.commission !== null ? 'checked' : ''} data-action="toggleCommission" data-idx="${idx}" class="h-5 w-5 rounded" />
              <span>Comissão</span>
            </label>
            <label class="flex items-center space-x-2 text-soft text-xs cursor-pointer select-none">
              <input type="checkbox" ${h.freebet ? 'checked' : ''} data-action="toggleFreebet" data-idx="${idx}" class="h-5 w-5 rounded" />
              <span>Freebet</span>
            </label>
          </div>

          ${h.commission !== null ? `
          <div>
            <label class="text-soft text-xs mb-1 block" for="commission-${idx}">Comissão (%)</label>
            <div class="relative">
              <input id="commission-${idx}" data-action="commissionValue" data-idx="${idx}" type="text" inputmode="decimal" value="${h.commission === 0 ? '' : (h.commission ?? '')}"
                class="flex h-8 w-full rounded-lg box text-strong px-3 text-xs font-mono pr-10" />
              <span class="absolute right-3 top-1/2 -translate-y-1/2 text-soft text-xs font-bold">%</span>
            </div>
          </div>` : ``}

          ${h.lay ? `
          <div class="mt-2">
            <label class="text-soft mb-1 block text-xs" for="responsibility-${idx}">Responsabilidade</label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-soft text-xs font-bold">R$</span>
              <input id="responsibility-${idx}" data-action="responsibility" data-idx="${idx}" type="text" inputmode="decimal" value="${h.responsibility || ''}"
                class="pl-10 flex h-8 w-full rounded-lg box text-strong px-3 text-xs font-mono" />
            </div>
          </div>` : ``}

          <button data-action="fixStake" data-idx="${idx}" class="w-full h-8 text-xs font-bold uppercase rounded-lg ${h.fixedStake ? 'btn' : 'bg-card'}">
            ${h.fixedStake ? 'Stake Fixa' : 'Fixar Stake'}
          </button>
        </div>
      </div>
    `;
  }
  function housesInnerHTML() { return activeHouses().map((h, idx) => cardHTML(idx, h)).join(""); }

  function renderResultsShell() {
    return `
      <div class="panel p-4 shadow-lg mt-4">
        <h2 class="text-accent text-lg mb-4 font-bold uppercase tracking-wider text-center">Resultados</h2>
        <div class="bg-card rounded-lg overflow-x-auto shadow-inner">
          <div id="resultsHeader" class="grid text-strong p-3 border-b font-bold text-xs whitespace-nowrap min-w-max uppercase tracking-wider grid-cols-5 gap-3">
            <div class="min-w-16 text-center">CASA</div>
            <div class="min-w-16 text-center">ODD</div>
            <div class="min-w-16 text-center">COMISSÃO</div>
            <div class="min-w-20 text-center">STAKE</div>
            <div class="min-w-20 text-center">LUCRO</div>
          </div>
          <div id="resultsRows"></div>
        </div>
      </div>
    `;
  }

  function updateResultsUI() {
    $("#totalStake").textContent = fmtBRL(results.totalStake);
    const roiEl = $("#roi");
    roiEl.textContent = (results.roi >= 0 ? "+" : "") + results.roi.toFixed(2) + "%";
    roiEl.className = "text-lg font-bold font-mono " + (results.roi >= 0 ? "text-green-400" : "text-red-400");

    const active = activeHouses();
    const anyLay = active.some(h => h.lay);
    const headerCols = anyLay ? "grid-cols-6 gap-3" : "grid-cols-5 gap-3";
    const header = `
      <div class="grid text-strong p-3 border-b font-bold text-xs whitespace-nowrap min-w-max uppercase tracking-wider ${headerCols}">
        <div class="min-w-16 text-center">CASA</div>
        <div class="min-w-16 text-center">ODD</div>
        <div class="min-w-16 text-center">COMISSÃO</div>
        <div class="min-w-20 text-center">STAKE</div>
        ${anyLay ? '<div class="min-w-24 text-center">RESP.</div>' : ''}
        <div class="min-w-20 text-center">LUCRO</div>
      </div>
    `;
    document.getElementById("resultsHeader").outerHTML = header.replace('<div class="grid', '<div id="resultsHeader" class="grid');

    const rowsHTML = active.map((h, idx) => {
      const oddText = h.freebet ? toFixed2(parseFlex(h.odd) || 0).replace('.', ',')
                                : toFixed2(h.finalOdd || 0).replace('.', ',');
      const commissionText = (h.commission === null)
        ? '—'
        : ((Number.isFinite(h.commission) ? h.commission : 0).toLocaleString('pt-BR', { maximumFractionDigits: 2 }) + ' %');
      const stakeText = h.stake ? h.stake : "0,00";
      const profit = results.profits[idx] || 0;
      const profitPos = profit >= 0;
      return `
        <div class="grid p-3 border-b text-xs whitespace-nowrap min-w-max ${headerCols}">
          <div class="text-soft min-w-16 text-center font-medium">Casa ${idx + 1}</div>
          <div class="text-strong min-w-16 text-center font-mono">${oddText}</div>
          <div class="text-strong min-w-16 text-center font-mono">${commissionText}</div>
          <div class="text-strong min-w-20 text-center font-mono flex items-center justify-center gap-1">
            R$ ${stakeText}${h.freebet ? '<span class="text-yellow-400 text-[10px]">(Freebet)</span>' : ''}
          </div>
          ${anyLay ? `<div class="text-strong min-w-24 text-center font-mono">${h.lay ? fmtBRL(parseFlex(h.responsibility)||0) : '-'}</div>` : ''}
          <div class="min-w-20 text-center font-mono font-bold ${profitPos ? 'text-green-400' : 'text-red-400'}">${profitPos ? '' : '-'}${fmtBRL(Math.abs(profit))}</div>
        </div>
      `;
    }).join("");
    document.getElementById("resultsRows").innerHTML = rowsHTML;
  }

  function updateCardComputed(idx) {
    const h = houses[idx];
    const oddEl = document.getElementById(`finalOdd-${idx}`);
    if (oddEl) oddEl.textContent = toFixed2(h.finalOdd || 0).replace('.', ',');
    if (h.lay && !(manualOverrides[idx] && manualOverrides[idx].responsibility)) {
      const rEl = document.getElementById(`responsibility-${idx}`);
      if (rEl) rEl.value = h.responsibility || "";
    }
    if (!(manualOverrides[idx] && manualOverrides[idx].stake)) {
      const sEl = document.getElementById(`stake-${idx}`);
      if (sEl) sEl.value = h.stake || "";
    }
  }
  function updateAllHouseUIs(){ activeHouses().forEach((_,i)=>updateCardComputed(i)); }

  function initialRender() {
    const app = $("#app");
    app.innerHTML = `
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-4">
        <div class="panel p-3">
          <h2 class="text-accent text-sm mb-2 font-bold text-center uppercase tracking-wider">Configurações</h2>
          <label class="text-soft mb-1 block text-xs">Número de Casas:</label>
          <select id="numHouses" class="flex h-8 w-full rounded-lg box text-strong px-3 text-xs">
            <option value="2" ${numHouses===2?'selected':''}>2 Casas</option>
            <option value="3" ${numHouses===3?'selected':''}>3 Casas</option>
            <option value="4" ${numHouses===4?'selected':''}>4 Casas</option>
            <option value="5" ${numHouses===5?'selected':''}>5 Casas</option>
          </select>
        </div>

        <div class="panel p-3">
          <h2 class="text-accent text-sm mb-2 font-bold text-center uppercase tracking-wider">Arredondamento</h2>
          <label class="text-soft mb-1 block text-xs">Stakes Para:</label>
          <select id="rounding" class="flex h-8 w-full rounded-lg box text-strong px-3 text-xs">
            <option value="0.01" ${displayRounding==="0.01"?'selected':''}>R$ 0,01</option>
            <option value="0.10" ${displayRounding==="0.10"?'selected':''}>R$ 0,10</option>
            <option value="0.50" ${displayRounding==="0.50"?'selected':''}>R$ 0,50</option>
            <option value="1.00" ${displayRounding==="1.00"?'selected':''}>R$ 1,00</option>
          </select>
        </div>

        <div class="panel p-3 text-center">
          <h2 class="text-accent text-sm mb-2 font-bold uppercase tracking-wider">Total Investido</h2>
          <div id="totalStake" class="text-lg text-strong font-bold font-mono">R$ 0,00</div>
        </div>

        <div class="panel p-3 text-center">
          <h2 class="text-accent text-sm mb-2 font-bold uppercase tracking-wider">ROI Médio</h2>
          <div id="roi" class="text-lg font-bold font-mono text-green-400">0,00%</div>
        </div>
      </div>
      <div id="houses" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4"></div>
      ${renderResultsShell()}
    `;
    document.getElementById("houses").innerHTML = housesInnerHTML();

    document.getElementById("numHouses").addEventListener("change", (e) => {
      numHouses = parseInt(e.target.value, 10);
      document.getElementById("houses").innerHTML = housesInnerHTML();
      scheduleUpdate();
    });
    document.getElementById("rounding").addEventListener("change", (e) => {
      displayRounding = e.target.value;
      roundingValue = parseFloat(displayRounding.replace(',', '.'));
      scheduleUpdate();
    });

    const container = document.getElementById("houses");

    container.addEventListener("input", (e) => {
      const t = e.target;
      if (t.getAttribute && t.getAttribute("inputmode") === "decimal") {
        const caret = t.selectionStart;
        const before = t.value;
        t.value = keepNumeric(before);
        try { t.setSelectionRange(caret, caret); } catch {}
      }
      if (!t.getAttribute) return;
      const action = t.getAttribute("data-action");
      if (!action) return;
      const idx = parseInt(t.getAttribute("data-idx") || "-1", 10);
      if (idx < 0) return;

      if (action === "odd") setHouse(idx, { odd: t.value });
      else if (action === "stake") setHouse(idx, { stake: t.value }, ["stake"]);
      else if (action === "responsibility") setHouse(idx, { responsibility: t.value }, ["responsibility"]);
      else if (action === "commissionValue") {
        const val = parseFlex(t.value);
        if (Number.isFinite(val)) setHouse(idx, { commission: val });
        else if (t.value === "") setHouse(idx, { commission: 0 });
      }
      scheduleUpdate();
    });

    container.addEventListener("blur", (e) => {
      const el = e.target;
      if (el.getAttribute && el.getAttribute("inputmode") === "decimal") {
        const v = parseFlex(el.value);
        if (Number.isFinite(v)) el.value = fmtDec(v);
      }
    }, true);

    container.addEventListener("change", (e) => {
      const el = e.target;
      if (!el.getAttribute) return;
      const action = el.getAttribute("data-action");
      if (!action) return;
      const idx = parseInt(el.getAttribute("data-idx") || "-1", 10);
      if (idx < 0) return;

      if (action === "toggleCommission") {
        const newVal = el.checked ? 0 : null;
        setHouse(idx, { commission: newVal });
        const card = document.getElementById(`card-${idx}`);
        if (card) card.outerHTML = cardHTML(idx, houses[idx]);
      } else if (action === "toggleFreebet") {
        setHouse(idx, { freebet: el.checked });
      }
      scheduleUpdate();
    });

    container.addEventListener("click", (e) => {
      const el = e.target.closest && e.target.closest("[data-action]");
      if (!el) return;
      const action = el.getAttribute("data-action");
      const idx = parseInt(el.getAttribute("data-idx") || "-1", 10);
      if (idx < 0) return;

      if (action === "toggleLay") {
        setHouse(idx, { lay: !houses[idx].lay });
        const card = document.getElementById(`card-${idx}`);
        if (card) card.outerHTML = cardHTML(idx, houses[idx]);
      } else if (action === "fixStake") {
        houses = houses.map((h, i) => ({ ...h, fixedStake: i === idx ? !h.fixedStake : false }));
      }
      scheduleUpdate();
    });

    scheduleUpdate();
  }

  function setHouse(idx, patch, setOverrideKeys = []) {
    const prev = houses[idx];
    const h = { ...prev, ...patch };

    const oddVal = parseFlex(h.odd) || 0;
    const incVal = parseFlex(h.increase) || 0;
    h.finalOdd = h.freebet ? Math.max(oddVal - 1, 0) : oddVal * (1 + incVal / 100);

    if (h.lay && !(manualOverrides[idx] && manualOverrides[idx].responsibility)) {
      const stakeVal = parseFlex(h.stake) || 0;
      if (stakeVal > 0 && oddVal > 1) h.responsibility = fmtDec(stakeVal * (oddVal - 1));
      else if (!h.responsibility) h.responsibility = "";
    }

    houses[idx] = h;

    if (setOverrideKeys.length) {
      manualOverrides[idx] = manualOverrides[idx] || {};
      setOverrideKeys.forEach(k => manualOverrides[idx][k] = true);
    }

    const oddEl = document.getElementById(`finalOdd-${idx}`);
    if (oddEl) oddEl.textContent = toFixed2(h.finalOdd || 0).replace('.', ',');
  }

  initialRender();
})();
</script>

</body>
</html>
