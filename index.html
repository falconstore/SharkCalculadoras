<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora Surebet — Shark</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: dark; }
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  </style>
</head>
<body class="min-h-screen p-4 md:p-8" style="background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 25%, #16213e 50%, #0f3460 100%);">
  <div class="max-w-6xl mx-auto">
    <div id="app"></div>
  </div>

<script>
(() => {
  const $ = (sel, root=document) => root.querySelector(sel);

  function parseFlex(n) {
    if (n === null || n === undefined) return NaN;
    const s = String(n).trim();
    if (s === '') return NaN;
    const hasC = s.includes(',');
    const hasD = s.includes('.');
    let t = s;
    if (hasC && !hasD) t = s.replace(',', '.');               
    else if (hasC && hasD) t = s.replace(/\./g,'').replace(',', '.'); 
    const v = parseFloat(t);
    return Number.isFinite(v) ? v : NaN;
  }
  const toFixed2 = (n) => (Number.isFinite(n) ? n.toFixed(2) : "0.00");
  const fmtBRL = (n) => (Number.isFinite(n) ? n : 0).toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
  const fmtDec = (n) => Number.isFinite(n) ? n.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : "";
  const keepNumeric = (s) => s.replace(/[^0-9.,]/g, "");

  const MAX_HOUSES = 6;
  let numHouses = 2;
  let roundingValue = 0.01;
  let displayRounding = "0.01";
  let manualOverrides = {};

  let houses = Array.from({ length: MAX_HOUSES }).map((_, index) => ({
    odd: "",
    increase: "",
    finalOdd: 0,
    stake: "0",
    commission: null,
    freebet: false,
    fixedStake: index === 0,
    lay: false,
    responsibility: ""
  }));

  let results = { profits: [], totalStake: 0, roi: 0 };

  const roundStake = (value) => {
    const num = parseFlex(value);
    if (!Number.isFinite(num)) return value;
    const rounded = Math.round(num / roundingValue) * roundingValue;
    return fmtDec(rounded);
  };
  const activeHouses = () => houses.slice(0, numHouses);

  // ---------- cálculo ----------
  function calculateResults(active) {
    let totalStake = 0;
    const profits = new Array(active.length).fill(0);

    active.forEach(h => {
      const stake = parseFlex(h.stake) || 0;
      const resp  = parseFlex(h.responsibility) || 0;
      if (!h.freebet) totalStake += h.lay ? resp : stake;
    });

    active.forEach((h, idx) => {
      const stake = parseFlex(h.stake) || 0;
      const odd = h.finalOdd || 0;
      const commission = h.commission || 0;

      if (h.lay) {
        const resp = parseFlex(h.responsibility) || 0;
        profits[idx] = stake * (1 - commission/100) - (totalStake - resp);
      } else if (h.freebet) {
        const gross = stake * odd - totalStake;
        const comm  = gross > 0 ? (commission/100) * gross : 0;
        profits[idx] = gross - comm;
      } else {
        const effOdd = odd * (1 - commission/100);
        profits[idx] = stake * effOdd - totalStake;
      }
    });

    const minProfit = profits.length ? Math.min(...profits) : 0;
    const denom = active.some(h => h.freebet)
                  ? active.reduce((s,h)=>s+(h.freebet?(parseFlex(h.stake)||0):0),0) || 1
                  : (active.reduce((s,h)=> s + (h.freebet?0 : (h.lay? (parseFlex(h.responsibility)||0) : (parseFlex(h.stake)||0))), 0) || 1);
    const roi = (minProfit/denom)*100;

    results = { profits, totalStake, roi };
  }

  function recalcStakeDistribution() {
    const active = activeHouses();
    const fixedIndex = active.findIndex(h => h.fixedStake);
    if (fixedIndex === -1) return;

    const fixed = active[fixedIndex];
    const fixedStake = parseFlex(fixed.stake) || 0;
    const fixedOdd   = fixed.finalOdd;
    if (!(fixedStake > 0 && fixedOdd > 0)) return;

    let changed = false;
    const newHouses = [...houses];

    active.forEach((h, idx) => {
      const overrides = manualOverrides[idx] || {};
      const oddVal = parseFlex(h.odd) || 0;
      const stakeVal = parseFlex(h.stake) || 0;

      if (h.lay && !overrides.responsibility && oddVal > 1 && stakeVal > 0) {
        const responsibility = stakeVal * (oddVal - 1);
        const current = parseFlex(h.responsibility) || 0;
        if (Math.abs(current - responsibility) > 1e-6) {
          changed = true;
          newHouses[idx] = { ...newHouses[idx], responsibility: fmtDec(responsibility) };
        }
      }

      if (idx !== fixedIndex && h.finalOdd > 0 && !overrides.stake) {
        const fixedCommission = fixed.commission || 0;
        const houseCommission = h.commission || 0;
        const fixedProfit = fixedStake * fixedOdd * (1 - fixedCommission/100);

        let calcStake;
        if (h.lay) {
          calcStake = fixedProfit / (h.finalOdd - houseCommission/100);
        } else {
          const eff = h.finalOdd * (1 - houseCommission/100);
          calcStake = fixedProfit / eff;
        }

        const finalStakeStr = h.lay ? fmtDec(calcStake) : roundStake(calcStake);
        const finalStakeNum = parseFlex(finalStakeStr) || 0;
        const cur = parseFlex(h.stake) || 0;
        if (Math.abs(cur - finalStakeNum) > 1e-6) {
          changed = true;
          if (h.lay) {
            const resp = finalStakeNum * Math.max(oddVal - 1, 0);
            newHouses[idx] = { ...newHouses[idx], stake: finalStakeStr, responsibility: fmtDec(resp), fixedStake: false };
          } else {
            newHouses[idx] = { ...newHouses[idx], stake: finalStakeStr, fixedStake: false };
          }
        }
      }
    });

    if (changed) {
      houses = newHouses;
      updateAllHouseUIs();
    }
  }

  // ---------- UI ----------
  function cardHTML(idx, h) {
    const oddDisplay = toFixed2(h.finalOdd || 0).replace('.', ',');
    return `
      <div id="card-${idx}" class="bg-gray-900/40 backdrop-blur-md rounded-xl p-3 border border-cyan-500/20 shadow-lg shadow-cyan-500/10 hover:shadow-cyan-500/15 hover:border-cyan-400/30 transition-all duration-300 h-full">
        <h3 class="text-cyan-400 text-sm mb-2 font-bold uppercase tracking-wider text-center">Casa ${idx + 1}</h3>
        <div class="space-y-2">
          <div class="grid grid-cols-2 gap-2">
            <div>
              <label class="text-cyan-200 mb-1 block text-xs" for="odd-${idx}">Odd</label>
              <input id="odd-${idx}" data-action="odd" data-idx="${idx}" type="text" inputmode="decimal" value="${h.odd}"
                class="flex h-8 w-full rounded-lg bg-gray-900/50 border border-cyan-500/30 text-cyan-100 px-3 text-xs shadow-lg backdrop-blur-sm transition-all duration-200 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 focus:outline-none hover:border-cyan-400/50 placeholder:text-cyan-300/50" />
            </div>
            <div>
              <label class="text-cyan-200 mb-1 block text-xs">Odd Final</label>
              <div id="finalOdd-${idx}" class="h-8 flex items-center px-3 bg-gray-800/60 border border-cyan-500/20 rounded-lg text-xs text-cyan-100 font-mono">${oddDisplay}</div>
            </div>
          </div>

          <div>
            <label class="text-cyan-200 mb-1 block text-xs" for="stake-${idx}">Stake</label>
            <div class="flex gap-2">
              <div class="relative flex-1">
                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-cyan-300 text-xs font-bold">R$</span>
                <input id="stake-${idx}" data-action="stake" data-idx="${idx}" type="text" inputmode="decimal" value="${h.stake || ''}"
                  class="pl-10 flex h-8 w-full rounded-lg bg-gray-900/50 border border-cyan-500/30 text-cyan-100 px-3 text-xs shadow-lg backdrop-blur-sm transition-all duration-200 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 focus:outline-none hover:border-cyan-400/50 placeholder:text-cyan-300/50 font-mono" />
              </div>
              <button data-action="toggleLay" data-idx="${idx}"
                class="${h.lay ? 'bg-gradient-to-r from-purple-500 to-pink-500' : 'bg-gradient-to-r from-cyan-500 to-blue-500'} text-white shadow-lg ${h.lay ? 'shadow-purple-500/25' : 'shadow-cyan-500/25'} hover:shadow-cyan-500/40 hover:scale-105 active:scale-95 inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-xs font-black h-8 px-3 uppercase tracking-wider">
                ${h.lay ? 'L' : 'B'}
              </button>
            </div>
          </div>

          <div class="flex flex-wrap gap-3">
            <label class="flex items-center space-x-2 text-cyan-200 text-xs normal-case cursor-pointer select-none">
              <input type="checkbox" ${h.commission !== null ? 'checked' : ''} data-action="toggleCommission" data-idx="${idx}"
                class="h-5 w-5 rounded border-2 border-cyan-400/50 bg-gray-900/50 text-cyan-400 shadow-lg focus:ring-2 focus:ring-cyan-400/30 focus:ring-offset-0 transition-all duration-200 cursor-pointer accent-cyan-400" />
              <span>Comissão</span>
            </label>
            <label class="flex items-center space-x-2 text-cyan-200 text-xs normal-case cursor-pointer select-none">
              <input type="checkbox" ${h.freebet ? 'checked' : ''} data-action="toggleFreebet" data-idx="${idx}"
                class="h-5 w-5 rounded border-2 border-cyan-400/50 bg-gray-900/50 text-cyan-400 shadow-lg focus:ring-2 focus:ring-cyan-400/30 focus:ring-offset-0 transition-all duration-200 cursor-pointer accent-cyan-400" />
              <span>Freebet</span>
            </label>
          </div>

          ${h.commission !== null ? `
          <div>
            <label class="text-cyan-200 text-xs mb-1 block" for="commission-${idx}">Comissão (%)</label>
            <div class="relative">
              <input id="commission-${idx}" data-action="commissionValue" data-idx="${idx}" type="text" inputmode="decimal" value="${h.commission === 0 ? '' : (h.commission ?? '')}"
                class="flex h-8 w-full rounded-lg bg-gray-900/50 border border-cyan-500/30 text-cyan-100 px-3 text-xs shadow-lg backdrop-blur-sm transition-all duration-200 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 focus:outline-none hover:border-cyan-400/50 placeholder:text-cyan-300/50 font-mono pr-10" />
              <span class="absolute right-3 top-1/2 -translate-y-1/2 text-cyan-300 text-xs font-bold">%</span>
            </div>
          </div>` : ``}

          ${h.lay ? `
          <div class="mt-2">
            <label class="text-cyan-200 mb-1 block text-xs" for="responsibility-${idx}">Responsabilidade</label>
            <div class="relative">
              <span class="absolute left-3 top-1/2 -translate-y-1/2 text-cyan-300 text-xs font-bold">R$</span>
              <input id="responsibility-${idx}" data-action="responsibility" data-idx="${idx}" type="text" inputmode="decimal" value="${h.responsibility || ''}"
                class="pl-10 flex h-8 w-full rounded-lg bg-gray-900/50 border border-cyan-500/30 text-cyan-100 px-3 text-xs shadow-lg backdrop-blur-sm transition-all duration-200 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 focus:outline-none hover:border-cyan-400/50 placeholder:text-cyan-300/50 font-mono" />
            </div>
          </div>` : ``}

          <button data-action="fixStake" data-idx="${idx}"
            class="w-full h-8 text-xs font-bold uppercase tracking-wider rounded-lg ${h.fixedStake ? 'bg-gradient-to-r from-green-500 to-emerald-500 shadow-green-500/25' : 'bg-gradient-to-r from-gray-600 to-gray-700 shadow-gray-600/25'}">
            ${h.fixedStake ? 'Stake Fixa' : 'Fixar Stake'}
          </button>
        </div>
      </div>
    `;
  }

  function housesInnerHTML() {
    return activeHouses().map((h, idx) => cardHTML(idx, h)).join("");
  }

  function renderTop() {
    return `
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-4">
        <div class="bg-gray-900/40 backdrop-blur-md rounded-xl p-3 border border-cyan-500/20 shadow-lg shadow-cyan-500/10">
          <h2 class="text-cyan-400 text-sm mb-2 font-bold uppercase tracking-wider text-center">Configurações</h2>
          <label class="text-cyan-200 mb-1 block text-xs">Número de Casas:</label>
          <select id="numHouses" class="flex h-8 w-full rounded-lg bg-gray-900/50 border border-cyan-500/30 text-cyan-100 px-3 text-xs shadow-lg backdrop-blur-sm transition-all duration-200 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 focus:outline-none hover:border-cyan-400/50">
            <option value="2" ${numHouses===2?'selected':''}>2 Casas</option>
            <option value="3" ${numHouses===3?'selected':''}>3 Casas</option>
            <option value="4" ${numHouses===4?'selected':''}>4 Casas</option>
            <option value="5" ${numHouses===5?'selected':''}>5 Casas</option>
          </select>
        </div>

        <div class="bg-gray-900/40 backdrop-blur-md rounded-xl p-3 border border-cyan-500/20 shadow-lg shadow-cyan-500/10">
          <h2 class="text-cyan-400 text-sm mb-2 font-bold uppercase tracking-wider text-center">Arredondamento</h2>
          <label class="text-cyan-200 mb-1 block text-xs">Stakes Para:</label>
          <select id="rounding" class="flex h-8 w-full rounded-lg bg-gray-900/50 border border-cyan-500/30 text-cyan-100 px-3 text-xs shadow-lg backdrop-blur-sm transition-all duration-200 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 focus:outline-none hover:border-cyan-400/50">
            <option value="0.01" ${displayRounding==="0.01"?'selected':''}>R$ 0,01</option>
            <option value="0.10" ${displayRounding==="0.10"?'selected':''}>R$ 0,10</option>
            <option value="0.50" ${displayRounding==="0.50"?'selected':''}>R$ 0,50</option>
            <option value="1.00" ${displayRounding==="1.00"?'selected':''}>R$ 1,00</option>
          </select>
        </div>

        <div class="bg-gray-900/40 backdrop-blur-md rounded-xl p-3 border border-cyan-500/20 shadow-lg shadow-cyan-500/10 text-center">
          <h2 class="text-cyan-400 text-sm mb-2 font-bold uppercase tracking-wider">Total Investido</h2>
          <div id="totalStake" class="text-lg text-cyan-100 font-bold font-mono">R$ 0,00</div>
        </div>

        <div class="bg-gray-900/40 backdrop-blur-md rounded-xl p-3 border border-cyan-500/20 shadow-lg shadow-cyan-500/10 text-center">
          <h2 class="text-cyan-400 text-sm mb-2 font-bold uppercase tracking-wider">ROI Médio</h2>
          <div id="roi" class="text-lg font-bold font-mono text-green-400">0,00%</div>
        </div>
      </div>
    `;
  }

  function renderResultsShell() {
    return `
      <div class="bg-gray-900/40 backdrop-blur-md rounded-xl p-4 border border-cyan-500/20 shadow-lg shadow-cyan-500/10 mt-4">
        <h2 class="text-cyan-400 text-lg mb-4 font-bold uppercase tracking-wider text-center">Resultados</h2>
        <div class="bg-gray-800/50 rounded-lg overflow-x-auto border border-cyan-500/30 shadow-inner">
          <div id="resultsHeader" class="grid text-cyan-100 p-3 border-b border-cyan-500/20 font-bold text-xs whitespace-nowrap min-w-max uppercase tracking-wider grid-cols-4 gap-3">
            <div class="min-w-16 text-center">CASA</div>
            <div class="min-w-16 text-center">ODD</div>
            <div class="min-w-20 text-center">STAKE</div>
            <div class="min-w-20 text-center">LUCRO</div>
          </div>
          <div id="resultsRows"></div>
        </div>
      </div>
    `;
  }

  function updateResultsUI() {
    $("#totalStake").textContent = fmtBRL(results.totalStake);
    const roiEl = $("#roi");
    roiEl.textContent = (results.roi >= 0 ? "+" : "") + results.roi.toFixed(2) + "%";
    roiEl.className = "text-lg font-bold font-mono " + (results.roi >= 0 ? "text-green-400" : "text-red-400");

    const active = activeHouses();
    const anyLay = active.some(h => h.lay);
    const headerCols = anyLay ? "grid-cols-5 gap-3" : "grid-cols-4 gap-3";
    const header = `
      <div class="grid text-cyan-100 p-3 border-b border-cyan-500/20 font-bold text-xs whitespace-nowrap min-w-max uppercase tracking-wider ${headerCols}">
        <div class="min-w-16 text-center">CASA</div>
        <div class="min-w-16 text-center">ODD</div>
        <div class="min-w-20 text-center">STAKE</div>
        ${anyLay ? '<div class="min-w-24 text-center">RESP.</div>' : ''}
        <div class="min-w-20 text-center">LUCRO</div>
      </div>
    `;
    $("#resultsHeader").outerHTML = header.replace('<div class="grid', '<div id="resultsHeader" class="grid');

    const rowsHTML = active.map((h, idx) => {
      const oddText = h.freebet ? toFixed2(parseFlex(h.odd) || 0).replace('.', ',')
                                : toFixed2(h.finalOdd || 0).replace('.', ',');
      const stakeText = h.stake ? h.stake : "0,00";
      const profit = results.profits[idx] || 0;
      const profitPos = profit >= 0;
      return `
        <div class="grid p-3 border-b border-cyan-500/10 text-xs whitespace-nowrap min-w-max hover:bg-cyan-500/5 transition-colors duration-200 ${headerCols}">
          <div class="text-cyan-200 min-w-16 text-center font-medium">Casa ${idx + 1}</div>
          <div class="text-cyan-100 min-w-16 text-center font-mono">${oddText}</div>
          <div class="text-cyan-100 min-w-20 text-center font-mono flex items-center justify-center gap-1">R$ ${stakeText}${h.freebet ? '<span class="text-yellow-400 text-[10px]">(Freebet)</span>' : ''}</div>
          ${anyLay ? `<div class="text-cyan-100 min-w-24 text-center font-mono">${h.lay ? fmtBRL(parseFlex(h.responsibility)||0) : '-'}</div>` : ''}
          <div class="min-w-20 text-center font-mono font-bold ${profitPos ? 'text-green-400' : 'text-red-400'}">${profitPos ? '' : '-'}${fmtBRL(Math.abs(profit))}</div>
        </div>
      `;
    }).join("");
    $("#resultsRows").innerHTML = rowsHTML;
  }

  function updateCardComputed(idx) {
    const h = houses[idx];
    const oddEl = document.getElementById(`finalOdd-${idx}`);
    if (oddEl) oddEl.textContent = toFixed2(h.finalOdd || 0).replace('.', ',');
    if (h.lay && !(manualOverrides[idx] && manualOverrides[idx].responsibility)) {
      const rEl = document.getElementById(`responsibility-${idx}`);
      if (rEl) rEl.value = h.responsibility || "";
    }
    if (!(manualOverrides[idx] && manualOverrides[idx].stake)) {
      const sEl = document.getElementById(`stake-${idx}`);
      if (sEl) sEl.value = h.stake || "";
    }
  }
  function updateAllHouseUIs(){ activeHouses().forEach((_,i)=>updateCardComputed(i)); }

  // ---------- render ----------
  function initialRender() {
    const app = $("#app");
    app.innerHTML = `${renderTop()}<div id="houses" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-4"></div>${renderResultsShell()}`;
    $("#houses").innerHTML = housesInnerHTML();

    // eventos globais
    $("#numHouses").addEventListener("change", (e) => {
      numHouses = parseInt(e.target.value, 10);
      // mantém o mesmo nó #houses; troca só innerHTML (não perde listeners delegados)
      $("#houses").innerHTML = housesInnerHTML();
      calculateResults(activeHouses()); updateAllHouseUIs(); updateResultsUI();
    });

    $("#rounding").addEventListener("change", (e) => {
      displayRounding = e.target.value;
      roundingValue = parseFloat(displayRounding.replace(',', '.'));
      recalcStakeDistribution();
      calculateResults(activeHouses()); updateAllHouseUIs(); updateResultsUI();
    });

    // Delegação única no wrapper fixo
    const container = $("#houses");

    // máscara decimal + tratamento de input
    container.addEventListener("input", (e) => {
      const t = e.target;
      if (t.getAttribute && t.getAttribute("inputmode") === "decimal") {
        const caret = t.selectionStart;
        const before = t.value;
        t.value = keepNumeric(before);
        try { t.setSelectionRange(caret, caret); } catch {}
      }
      if (!t.getAttribute) return;
      const action = t.getAttribute("data-action");
      if (!action) return;
      const idx = parseInt(t.getAttribute("data-idx") || "-1", 10);
      if (idx < 0) return;

      if (action === "odd") {
        setHouse(idx, { odd: t.value });
      } else if (action === "stake") {
        setHouse(idx, { stake: t.value }, ["stake"]);
      } else if (action === "responsibility") {
        setHouse(idx, { responsibility: t.value }, ["responsibility"]);
      } else if (action === "commissionValue") {
        const val = parseFlex(t.value);
        if (Number.isFinite(val)) setHouse(idx, { commission: val });
        else if (t.value === "") setHouse(idx, { commission: 0 });
      }

      recalcStakeDistribution();
      calculateResults(activeHouses()); updateAllHouseUIs(); updateResultsUI();
    });

    // blur -> formatação
    container.addEventListener("blur", (e) => {
      const el = e.target;
      if (el.getAttribute && el.getAttribute("inputmode") === "decimal") {
        const v = parseFlex(el.value);
        if (Number.isFinite(v)) el.value = fmtDec(v);
      }
    }, true);

    // checkboxes
    container.addEventListener("change", (e) => {
      const el = e.target;
      if (!el.getAttribute) return;
      const action = el.getAttribute("data-action");
      if (!action) return;
      const idx = parseInt(el.getAttribute("data-idx") || "-1", 10);
      if (idx < 0) return;

      if (action === "toggleCommission") {
        const newVal = el.checked ? 0 : null;
        setHouse(idx, { commission: newVal });
        // re-render só o card (estrutura muda)
        const card = document.getElementById(`card-${idx}`);
        if (card) card.outerHTML = cardHTML(idx, houses[idx]);
      } else if (action === "toggleFreebet") {
        setHouse(idx, { freebet: el.checked });
      }
      recalcStakeDistribution();
      calculateResults(activeHouses()); updateAllHouseUIs(); updateResultsUI();
    });

    // botões
    container.addEventListener("click", (e) => {
      const el = e.target.closest && e.target.closest("[data-action]");
      if (!el) return;
      const action = el.getAttribute("data-action");
      const idx = parseInt(el.getAttribute("data-idx") || "-1", 10);
      if (idx < 0) return;

      if (action === "toggleLay") {
        setHouse(idx, { lay: !houses[idx].lay });
        const card = document.getElementById(`card-${idx}`);
        if (card) card.outerHTML = cardHTML(idx, houses[idx]);
      } else if (action === "fixStake") {
        houses = houses.map((h, i) => ({ ...h, fixedStake: i === idx ? !h.fixedStake : false }));
      }
      recalcStakeDistribution();
      calculateResults(activeHouses()); updateAllHouseUIs(); updateResultsUI();
    });

    // inicial
    calculateResults(activeHouses()); updateAllHouseUIs(); updateResultsUI();
  }

  function setHouse(idx, patch, setOverrideKeys = []) {
    const prev = houses[idx];
    const h = { ...prev, ...patch };
    const oddVal = parseFlex(h.odd) || 0;
    const incVal = parseFlex(h.increase) || 0;
    h.finalOdd = h.freebet ? Math.max(oddVal - 1, 0) : oddVal * (1 + incVal / 100);

    if (h.lay && !(manualOverrides[idx] && manualOverrides[idx].responsibility)) {
      const stakeVal = parseFlex(h.stake) || 0;
      if (stakeVal > 0 && oddVal > 1) h.responsibility = fmtDec(stakeVal * (oddVal - 1));
      else if (!h.responsibility) h.responsibility = "";
    }

    houses[idx] = h;

    if (setOverrideKeys.length) {
      manualOverrides[idx] = manualOverrides[idx] || {};
      setOverrideKeys.forEach(k => manualOverrides[idx][k] = true);
    }

    // sincroniza card atual (sem perder digitação)
    const i = idx;
    const oddEl = document.getElementById(`finalOdd-${i}`);
    if (oddEl) oddEl.textContent = toFixed2(h.finalOdd || 0).replace('.', ',');
  }

  // boot
  initialRender();
})();
</script>

</body>
</html>
